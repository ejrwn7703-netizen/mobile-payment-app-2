# ë¬´ì¸ê³„ì‚° ëª¨ë°”ì¼ ì•± ë³´ì™„ ê°€ì´ë“œë¼ì¸

## ğŸ“‹ ë¬¸ì„œ ì •ë³´
- ì‘ì„±ì¼: 2025ë…„ 11ì›” 20ì¼
- ë²„ì „: 1.0
- ëŒ€ìƒ: ë¬´ì¸ê³„ì‚° ëª¨ë°”ì¼ ì•± ê°œë°œ ë° ìš´ì˜íŒ€

---

## ğŸ”’ 1. ë³´ì•ˆ ë° ë¶€ì • ì‚¬ìš© ë°©ì§€ ê°€ì´ë“œë¼ì¸

### 1.1 ì ˆë„ ë°©ì§€ ë©”ì»¤ë‹ˆì¦˜

#### 1.1.1 ë‹¤ì¸µ ë³´ì•ˆ ì‹œìŠ¤í…œ
```
ğŸ¯ êµ¬í˜„ ëª©í‘œ: 99.5% ì´ìƒì˜ ë¶€ì • ì‚¬ìš© íƒì§€ìœ¨ ë‹¬ì„±

í•„ìˆ˜ êµ¬ì„± ìš”ì†Œ:
âœ… ì…êµ¬/ì¶œêµ¬ ê²Œì´íŠ¸ ì‹œìŠ¤í…œ
âœ… ì¤‘ëŸ‰ ì„¼ì„œ ê¸°ë°˜ ìƒí’ˆ ê²€ì¦
âœ… AI ê¸°ë°˜ í–‰ë™ ë¶„ì„ ì¹´ë©”ë¼
âœ… RFID/NFC íƒœê·¸ ìƒí’ˆ ì¸ì‹
âœ… ì‹¤ì‹œê°„ ë§¤ì¥ ê´€ë¦¬ì ì•Œë¦¼ ì‹œìŠ¤í…œ
```

#### 1.1.2 ì¤‘ëŸ‰ ê²€ì¦ ì‹œìŠ¤í…œ
```python
# ì˜ˆì‹œ: ì¤‘ëŸ‰ ê²€ì¦ ë¡œì§
class WeightVerificationSystem:
    def __init__(self):
        self.tolerance = 0.05  # 5% ì˜¤ì°¨ í—ˆìš©
    
    def verify_cart_weight(self, scanned_items, measured_weight):
        expected_weight = sum(item.weight * item.quantity for item in scanned_items)
        weight_diff = abs(measured_weight - expected_weight) / expected_weight
        
        if weight_diff > self.tolerance:
            return {
                "status": "VERIFICATION_FAILED",
                "expected": expected_weight,
                "measured": measured_weight,
                "action": "REQUIRE_MANUAL_CHECK"
            }
        return {"status": "VERIFIED"}
```

#### 1.1.3 AI ê¸°ë°˜ í–‰ë™ ë¶„ì„
```yaml
# AI ëª¨ë¸ ìš”êµ¬ì‚¬í•­
behavior_detection:
  models:
    - object_detection: "YOLOv8 ê¸°ë°˜ ìƒí’ˆ ì¸ì‹"
    - action_recognition: "í–‰ë™ íŒ¨í„´ ë¶„ì„"
    - anomaly_detection: "ì´ìƒ í–‰ë™ íƒì§€"
  
  alert_triggers:
    - ìŠ¤ìº”í•˜ì§€ ì•Šê³  ìƒí’ˆ ì£¼ë¨¸ë‹ˆì— ë„£ê¸°
    - ë°”ì½”ë“œ ê°€ë¦¬ê³  ìŠ¤ìº”í•˜ê¸°
    - ì¥ì‹œê°„ ë™ì¼ ìœ„ì¹˜ì—ì„œ ë¨¸ë¬´ë¥´ê¸°
    - ë¹„ì •ìƒì ì¸ ì›€ì§ì„ íŒ¨í„´
  
  confidence_threshold: 0.85
  false_positive_rate: < 2%
```

### 1.2 ì¶œêµ¬ ë³´ì•ˆ ê°•í™”

#### 1.2.1 ë‹¤ë‹¨ê³„ ì¶œêµ¬ ê²€ì¦
```
Stage 1: QR/NFC ì½”ë“œ ìŠ¤ìº”
Stage 2: ì¤‘ëŸ‰ ê²€ì¦ (ì‡¼í•‘ë°± + ìƒí’ˆ)
Stage 3: ëœë¤ ìœ¡ì•ˆ ê²€ì‚¬ (5% í™•ë¥ )
Stage 4: AI ì¹´ë©”ë¼ ìµœì¢… í™•ì¸
```

#### 1.2.2 ì¶œêµ¬ ê²Œì´íŠ¸ API ëª…ì„¸
```json
{
  "endpoint": "/api/v1/exit-verification",
  "method": "POST",
  "request": {
    "user_id": "string",
    "transaction_id": "string",
    "exit_code": "string",
    "measured_weight": "number",
    "timestamp": "ISO8601"
  },
  "response": {
    "verification_status": "APPROVED|DENIED|MANUAL_CHECK",
    "gate_action": "OPEN|CLOSE|ALERT",
    "message": "string"
  }
}
```

---

## ğŸ›¡ï¸ 2. ê¸°ìˆ ì  ë³´ì•ˆ ê°•í™”

### 2.1 ë°ì´í„° ì•”í˜¸í™” ì •ì±…

#### 2.1.1 ì „ì†¡ ì¤‘ ë°ì´í„° ë³´í˜¸
```yaml
encryption_standards:
  transport_layer:
    protocol: "TLS 1.3"
    cipher_suites: 
      - "TLS_AES_256_GCM_SHA384"
      - "TLS_CHACHA20_POLY1305_SHA256"
    certificate: "EV SSL Certificate"
    hsts_enabled: true
    
  api_security:
    authentication: "OAuth 2.0 + JWT"
    token_expiry: "15ë¶„ (ì•¡ì„¸ìŠ¤), 7ì¼ (ë¦¬í”„ë ˆì‹œ)"
    rate_limiting: "100 req/min per user"
```

#### 2.1.2 ì €ì¥ ë°ì´í„° ì•”í˜¸í™”
```sql
-- ë¯¼ê° ë°ì´í„° ì•”í˜¸í™” ìŠ¤í‚¤ë§ˆ
CREATE TABLE users (
    id BIGINT PRIMARY KEY,
    phone_encrypted VARBINARY(256), -- AES-256 ì•”í˜¸í™”
    email_encrypted VARBINARY(256),
    name_hash VARCHAR(64),           -- SHA-256 í•´ì‹œ
    created_at TIMESTAMP DEFAULT NOW(),
    last_login TIMESTAMP,
    -- PII ë°ì´í„°ëŠ” ë³„ë„ ì•”í˜¸í™”ëœ í…Œì´ë¸”ì— ì €ì¥
    INDEX idx_phone_hash (phone_encrypted),
    INDEX idx_email_hash (email_encrypted)
);

-- ê²°ì œ ì •ë³´ëŠ” í† í°ìœ¼ë¡œë§Œ ì €ì¥
CREATE TABLE payment_tokens (
    id BIGINT PRIMARY KEY,
    user_id BIGINT,
    pg_provider ENUM('NAVER_PAY', 'KAKAO_PAY'),
    payment_token VARCHAR(255), -- PGì‚¬ ë°œê¸‰ í† í°
    expires_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW(),
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

### 2.2 API ë³´ì•ˆ ì„¤ê³„

#### 2.2.1 ì¸ì¦ ë° ì¸ê°€ ì‹œìŠ¤í…œ
```python
# JWT í† í° êµ¬ì¡° ì˜ˆì‹œ
{
  "header": {
    "alg": "RS256",
    "typ": "JWT"
  },
  "payload": {
    "sub": "user_id",
    "iat": 1637123456,
    "exp": 1637124356,
    "scope": ["scan:products", "payment:process"],
    "store_id": "store_001",
    "session_id": "sess_abc123"
  }
}

# API ê¶Œí•œ ë§¤íŠ¸ë¦­ìŠ¤
PERMISSION_MATRIX = {
    "CUSTOMER": [
        "scan:products",
        "cart:manage", 
        "payment:process",
        "receipt:view"
    ],
    "STORE_MANAGER": [
        "products:manage",
        "inventory:view",
        "sales:view",
        "users:view_anonymous"
    ],
    "SYSTEM_ADMIN": [
        "system:manage",
        "stores:manage",
        "analytics:view",
        "logs:access"
    ]
}
```

#### 2.2.2 API ìš”ì²­ ê²€ì¦
```python
from pydantic import BaseModel, validator
from typing import List, Optional

class ScanProductRequest(BaseModel):
    barcode: str
    store_id: str
    timestamp: int
    device_id: str
    
    @validator('barcode')
    def validate_barcode(cls, v):
        if not re.match(r'^[0-9]{8,13}$', v):
            raise ValueError('Invalid barcode format')
        return v
    
    @validator('timestamp')
    def validate_timestamp(cls, v):
        current_time = int(time.time())
        if abs(current_time - v) > 300:  # 5ë¶„ í—ˆìš©
            raise ValueError('Request timestamp too old')
        return v

class PaymentRequest(BaseModel):
    cart_items: List[CartItem]
    payment_method: str
    store_id: str
    total_amount: int
    
    @validator('total_amount')
    def validate_amount(cls, v, values):
        calculated_total = sum(
            item.price * item.quantity 
            for item in values.get('cart_items', [])
        )
        if abs(v - calculated_total) > 0:
            raise ValueError('Amount mismatch')
        return v
```

---

## ğŸ“± 3. ì‚¬ìš©ì ê²½í—˜(UX) ê°œì„  ê°€ì´ë“œë¼ì¸

### 3.1 ì˜¤í”„ë¼ì¸ ìƒí™© ëŒ€ì‘

#### 3.1.1 ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì„¤ê³„
```javascript
// ì˜¤í”„ë¼ì¸ ìƒíƒœ ê´€ë¦¬
class OfflineManager {
    constructor() {
        this.offlineQueue = [];
        this.isOnline = navigator.onLine;
        this.initEventListeners();
    }
    
    initEventListeners() {
        window.addEventListener('online', this.handleOnline.bind(this));
        window.addEventListener('offline', this.handleOffline.bind(this));
    }
    
    handleOffline() {
        this.isOnline = false;
        // ì˜¤í”„ë¼ì¸ ëª¨ë“œ UI í‘œì‹œ
        this.showOfflineNotification();
        // ë¡œì»¬ ìºì‹œëœ ìƒí’ˆ ì •ë³´ë§Œ ì‚¬ìš©
        this.enableOfflineMode();
    }
    
    handleOnline() {
        this.isOnline = true;
        // ì˜¤í”„ë¼ì¸ ì¤‘ ìŒ“ì¸ ìš”ì²­ë“¤ ë™ê¸°í™”
        this.syncOfflineActions();
        this.hideOfflineNotification();
    }
    
    cacheEssentialData() {
        // ìì£¼ ì‚¬ìš©ë˜ëŠ” ìƒí’ˆ ì •ë³´ ë¯¸ë¦¬ ìºì‹œ
        const essentialProducts = this.getFrequentlyScannedProducts();
        localStorage.setItem('offline_products', JSON.stringify(essentialProducts));
    }
}
```

#### 3.1.2 Progressive Web App (PWA) êµ¬í˜„
```json
{
  "name": "ë¬´ì¸ê³„ì‚° ì•±",
  "short_name": "SelfPay",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#007bff",
  "icons": [
    {
      "src": "/icons/icon-192.png",
      "sizes": "192x192",
      "type": "image/png"
    }
  ],
  "offline_fallback": "/offline.html"
}
```

### 3.2 ì ‘ê·¼ì„± ê°œì„ 

#### 3.2.1 ì‹œê° ì¥ì• ì¸ ì§€ì›
```yaml
accessibility_features:
  screen_reader:
    - "ëª¨ë“  UI ìš”ì†Œì— ì ì ˆí•œ aria-label ì œê³µ"
    - "ë°”ì½”ë“œ ìŠ¤ìº” ì„±ê³µ/ì‹¤íŒ¨ ìŒì„± í”¼ë“œë°±"
    - "ìƒí’ˆ ì •ë³´ TTS(Text-to-Speech) ì½ê¸°"
  
  voice_commands:
    - "ìŒì„±ìœ¼ë¡œ ìƒí’ˆ ê²€ìƒ‰"
    - "ìŒì„±ìœ¼ë¡œ ìˆ˜ëŸ‰ ë³€ê²½"
    - "ìŒì„±ìœ¼ë¡œ ê²°ì œ ì§„í–‰"
  
  high_contrast:
    - "ê³ ëŒ€ë¹„ ëª¨ë“œ ì§€ì›"
    - "í° í°íŠ¸ ëª¨ë“œ"
    - "ìƒ‰ìƒ ì—†ì´ë„ ì •ë³´ êµ¬ë¶„ ê°€ëŠ¥"
```

#### 3.2.2 ê³ ë ¹ì ì¹œí™”ì  UI
```css
/* ê³ ë ¹ìë¥¼ ìœ„í•œ UI ê°€ì´ë“œë¼ì¸ */
.senior-friendly {
    /* ìµœì†Œ ë²„íŠ¼ í¬ê¸°: 44px x 44px */
    min-height: 44px;
    min-width: 44px;
    
    /* ì¶©ë¶„í•œ ì—¬ë°± í™•ë³´ */
    padding: 16px;
    margin: 8px;
    
    /* ëª…í™•í•œ ìƒ‰ìƒ ëŒ€ë¹„ */
    background-color: #007bff;
    color: #ffffff;
    border: 2px solid #0056b3;
    
    /* ì½ê¸° ì‰¬ìš´ í°íŠ¸ */
    font-size: 18px;
    font-weight: 600;
    line-height: 1.5;
}

.error-message {
    /* ì˜¤ë¥˜ ë©”ì‹œì§€ëŠ” ë” í¬ê³  ëª…í™•í•˜ê²Œ */
    font-size: 20px;
    color: #dc3545;
    background-color: #f8d7da;
    border: 2px solid #dc3545;
    padding: 16px;
    border-radius: 8px;
}
```

---

## ğŸ’¾ 4. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ ê°€ì´ë“œë¼ì¸

### 4.1 ìƒì„¸ ìŠ¤í‚¤ë§ˆ ì„¤ê³„

#### 4.1.1 í•µì‹¬ í…Œì´ë¸” êµ¬ì¡°
```sql
-- ë§¤ì¥ ì •ë³´
CREATE TABLE stores (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    address TEXT NOT NULL,
    phone VARCHAR(20),
    business_hours JSON,
    timezone VARCHAR(50) DEFAULT 'Asia/Seoul',
    status ENUM('ACTIVE', 'INACTIVE', 'MAINTENANCE') DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW() ON UPDATE NOW(),
    
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
);

-- ìƒí’ˆ ì •ë³´ (ë§¤ì¥ë³„)
CREATE TABLE products (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    store_id BIGINT NOT NULL,
    barcode VARCHAR(50) NOT NULL,
    name VARCHAR(200) NOT NULL,
    description TEXT,
    price DECIMAL(10,2) NOT NULL,
    weight DECIMAL(8,3), -- ê·¸ë¨ ë‹¨ìœ„
    category_id INT,
    image_url VARCHAR(500),
    stock_quantity INT DEFAULT 0,
    min_stock_alert INT DEFAULT 10,
    status ENUM('ACTIVE', 'INACTIVE', 'OUT_OF_STOCK') DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW() ON UPDATE NOW(),
    
    FOREIGN KEY (store_id) REFERENCES stores(id),
    UNIQUE KEY uk_store_barcode (store_id, barcode),
    INDEX idx_barcode (barcode),
    INDEX idx_category (category_id),
    INDEX idx_status (status),
    FULLTEXT KEY ft_name_desc (name, description)
);

-- ì‚¬ìš©ì ì„¸ì…˜ ê´€ë¦¬
CREATE TABLE user_sessions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    store_id BIGINT NOT NULL,
    session_token VARCHAR(255) UNIQUE NOT NULL,
    device_info JSON,
    ip_address VARCHAR(45),
    entry_time TIMESTAMP DEFAULT NOW(),
    exit_time TIMESTAMP NULL,
    status ENUM('ACTIVE', 'COMPLETED', 'EXPIRED', 'TERMINATED') DEFAULT 'ACTIVE',
    
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (store_id) REFERENCES stores(id),
    INDEX idx_user_store (user_id, store_id),
    INDEX idx_session_token (session_token),
    INDEX idx_status_entry (status, entry_time)
);

-- ì¥ë°”êµ¬ë‹ˆ (ì„¸ì…˜ ê¸°ë°˜)
CREATE TABLE shopping_carts (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    session_id BIGINT NOT NULL,
    product_id BIGINT NOT NULL,
    quantity INT NOT NULL DEFAULT 1,
    unit_price DECIMAL(10,2) NOT NULL,
    added_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW() ON UPDATE NOW(),
    
    FOREIGN KEY (session_id) REFERENCES user_sessions(id),
    FOREIGN KEY (product_id) REFERENCES products(id),
    UNIQUE KEY uk_session_product (session_id, product_id),
    INDEX idx_session (session_id),
    INDEX idx_added_at (added_at)
);

-- ê±°ë˜ ë‚´ì—­
CREATE TABLE transactions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    session_id BIGINT NOT NULL,
    transaction_uuid VARCHAR(36) UNIQUE NOT NULL,
    user_id BIGINT NOT NULL,
    store_id BIGINT NOT NULL,
    total_amount DECIMAL(10,2) NOT NULL,
    payment_method ENUM('NAVER_PAY', 'KAKAO_PAY', 'CARD', 'CASH') NOT NULL,
    payment_status ENUM('PENDING', 'COMPLETED', 'FAILED', 'REFUNDED') DEFAULT 'PENDING',
    pg_transaction_id VARCHAR(100),
    receipt_data JSON,
    created_at TIMESTAMP DEFAULT NOW(),
    completed_at TIMESTAMP NULL,
    
    FOREIGN KEY (session_id) REFERENCES user_sessions(id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (store_id) REFERENCES stores(id),
    INDEX idx_user_date (user_id, created_at),
    INDEX idx_store_date (store_id, created_at),
    INDEX idx_status (payment_status),
    INDEX idx_pg_transaction (pg_transaction_id)
);

-- ê±°ë˜ ìƒí’ˆ ìƒì„¸
CREATE TABLE transaction_items (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    transaction_id BIGINT NOT NULL,
    product_id BIGINT NOT NULL,
    quantity INT NOT NULL,
    unit_price DECIMAL(10,2) NOT NULL,
    total_price DECIMAL(10,2) NOT NULL,
    
    FOREIGN KEY (transaction_id) REFERENCES transactions(id),
    FOREIGN KEY (product_id) REFERENCES products(id),
    INDEX idx_transaction (transaction_id),
    INDEX idx_product (product_id)
);
```

#### 4.1.2 ë³´ì•ˆ ê°ì‚¬ ë¡œê·¸
```sql
-- ë³´ì•ˆ ì´ë²¤íŠ¸ ë¡œê·¸
CREATE TABLE security_events (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    event_type ENUM(
        'SUSPICIOUS_BEHAVIOR',
        'WEIGHT_MISMATCH', 
        'MULTIPLE_SCAN_ATTEMPT',
        'UNAUTHORIZED_EXIT',
        'SYSTEM_INTRUSION'
    ) NOT NULL,
    user_id BIGINT,
    store_id BIGINT NOT NULL,
    session_id BIGINT,
    severity ENUM('LOW', 'MEDIUM', 'HIGH', 'CRITICAL') NOT NULL,
    description TEXT NOT NULL,
    metadata JSON,
    resolved BOOLEAN DEFAULT FALSE,
    resolved_by BIGINT,
    resolved_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT NOW(),
    
    FOREIGN KEY (store_id) REFERENCES stores(id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (resolved_by) REFERENCES users(id),
    INDEX idx_severity_created (severity, created_at),
    INDEX idx_store_type (store_id, event_type),
    INDEX idx_resolved (resolved)
);
```

### 4.2 ì„±ëŠ¥ ìµœì í™”

#### 4.2.1 ì¸ë±ì‹± ì „ëµ
```sql
-- ë³µí•© ì¸ë±ìŠ¤ ì „ëµ
CREATE INDEX idx_products_store_status_category 
ON products(store_id, status, category_id);

CREATE INDEX idx_transactions_user_date_status 
ON transactions(user_id, created_at DESC, payment_status);

-- íŒŒí‹°ì…”ë‹ (ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ìš©)
ALTER TABLE security_events 
PARTITION BY RANGE (YEAR(created_at)) (
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p2025 VALUES LESS THAN (2026),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

#### 4.2.2 ìºì‹± ì „ëµ
```yaml
redis_cache_strategy:
  product_info:
    key_pattern: "product:{store_id}:{barcode}"
    ttl: 3600  # 1ì‹œê°„
    update_trigger: "ìƒí’ˆ ì •ë³´ ë³€ê²½ ì‹œ"
  
  user_session:
    key_pattern: "session:{session_token}"
    ttl: 900   # 15ë¶„
    sliding_expiration: true
  
  popular_products:
    key_pattern: "popular:{store_id}:{date}"
    ttl: 86400 # 24ì‹œê°„
    update_schedule: "ë§¤ì¼ ìƒˆë²½ 2ì‹œ"
```

---

## ğŸš¨ 5. ì—ëŸ¬ ì²˜ë¦¬ ë° ëª¨ë‹ˆí„°ë§

### 5.1 í¬ê´„ì  ì—ëŸ¬ ì²˜ë¦¬

#### 5.1.1 ì—ëŸ¬ ë¶„ë¥˜ ì²´ê³„
```python
class ErrorCodes:
    # ì‚¬ìš©ì ì—ëŸ¬ (4000ë²ˆëŒ€)
    INVALID_BARCODE = 4001
    PRODUCT_NOT_FOUND = 4002
    INSUFFICIENT_STOCK = 4003
    INVALID_PAYMENT_METHOD = 4004
    
    # ì‹œìŠ¤í…œ ì—ëŸ¬ (5000ë²ˆëŒ€)
    DATABASE_CONNECTION_FAILED = 5001
    PAYMENT_GATEWAY_ERROR = 5002
    WEIGHT_SENSOR_MALFUNCTION = 5003
    AI_MODEL_ERROR = 5004
    
    # ë³´ì•ˆ ì—ëŸ¬ (6000ë²ˆëŒ€)
    SUSPICIOUS_ACTIVITY = 6001
    UNAUTHORIZED_ACCESS = 6002
    RATE_LIMIT_EXCEEDED = 6003
    TOKEN_EXPIRED = 6004

class CustomException(Exception):
    def __init__(self, error_code, message, details=None):
        self.error_code = error_code
        self.message = message
        self.details = details or {}
        super().__init__(self.message)
    
    def to_dict(self):
        return {
            "error_code": self.error_code,
            "message": self.message,
            "details": self.details,
            "timestamp": datetime.utcnow().isoformat()
        }
```

#### 5.1.2 ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€
```json
{
  "error_messages": {
    "ko": {
      "4001": "ë°”ì½”ë“œë¥¼ ì •í™•íˆ ì¸ì‹í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ìŠ¤ìº”í•´ì£¼ì„¸ìš”.",
      "4002": "í•´ë‹¹ ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì§ì›ì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.",
      "4003": "ìƒí’ˆì˜ ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.",
      "5002": "ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
      "6001": "ë³´ì•ˆìƒ ë¬¸ì œê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ë§¤ì¥ ì§ì›ì´ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤."
    },
    "en": {
      "4001": "Unable to recognize the barcode. Please scan again.",
      "4002": "Product not found. Please contact staff.",
      "4003": "Insufficient stock for this product.",
      "5002": "Payment processing error. Please try again later.",
      "6001": "Security issue detected. Staff will assist you."
    }
  }
}
```

### 5.2 ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ

#### 5.2.1 í•µì‹¬ ì§€í‘œ ëª¨ë‹ˆí„°ë§
```yaml
monitoring_metrics:
  business_metrics:
    - transaction_success_rate: "> 99.5%"
    - average_checkout_time: "< 60ì´ˆ"
    - cart_abandonment_rate: "< 5%"
    - theft_detection_accuracy: "> 95%"
  
  technical_metrics:
    - api_response_time: "< 500ms (95th percentile)"
    - database_connection_pool: "< 80% usage"
    - memory_usage: "< 80%"
    - cpu_usage: "< 70%"
  
  security_metrics:
    - failed_authentication_attempts: "< 10/hour per IP"
    - suspicious_behavior_alerts: "ì‹¤ì‹œê°„ ì•Œë¦¼"
    - weight_mismatch_incidents: "< 1% of transactions"
```

#### 5.2.2 ì•Œë¦¼ ì •ì±…
```python
# ì•Œë¦¼ ì‹œìŠ¤í…œ ì„¤ì •
ALERT_POLICIES = {
    "CRITICAL": {
        "conditions": [
            "transaction_failure_rate > 5%",
            "security_breach_detected",
            "payment_gateway_down"
        ],
        "channels": ["sms", "email", "slack", "phone_call"],
        "response_time": "1ë¶„ ì´ë‚´"
    },
    "HIGH": {
        "conditions": [
            "api_response_time > 2ì´ˆ",
            "theft_attempt_detected",
            "system_resource_critical"
        ],
        "channels": ["email", "slack"],
        "response_time": "5ë¶„ ì´ë‚´"
    },
    "MEDIUM": {
        "conditions": [
            "stock_low_warning",
            "user_experience_degraded"
        ],
        "channels": ["email"],
        "response_time": "30ë¶„ ì´ë‚´"
    }
}
```

---

## ğŸ“‹ 6. ë²•ì  ê·œì œ ì¤€ìˆ˜ ê°€ì´ë“œë¼ì¸

### 6.1 ê°œì¸ì •ë³´ë³´í˜¸ë²• ì¤€ìˆ˜

#### 6.1.1 ë°ì´í„° ìˆ˜ì§‘ ë° ì²˜ë¦¬ ì›ì¹™
```yaml
data_protection_policy:
  collection_principle:
    - purpose_limitation: "ëª…ì‹œëœ ëª©ì  ì™¸ ì‚¬ìš© ê¸ˆì§€"
    - data_minimization: "í•„ìš” ìµœì†Œí•œì˜ ì •ë³´ë§Œ ìˆ˜ì§‘"
    - accuracy: "ì •í™•í•˜ê³  ìµœì‹  ìƒíƒœ ìœ ì§€"
    - storage_limitation: "ë³´ê´€ ê¸°ê°„ ì¤€ìˆ˜"
  
  user_rights:
    - access_right: "ê°œì¸ì •ë³´ ì—´ëŒê¶Œ"
    - rectification_right: "ì •ì •Â·ì‚­ì œê¶Œ"  
    - portability_right: "ë°ì´í„° ì´ë™ê¶Œ"
    - objection_right: "ì²˜ë¦¬ ì •ì§€ê¶Œ"
  
  consent_management:
    - explicit_consent: "ëª…ì‹œì  ë™ì˜ íšë“"
    - granular_consent: "ì„¸ë¶„í™”ëœ ë™ì˜ ì˜µì…˜"
    - consent_withdrawal: "ë™ì˜ ì² íšŒ ê¸°ëŠ¥"
```

#### 6.1.2 ë°ì´í„° ë³´ê´€ ë° ì‚­ì œ ì •ì±…
```sql
-- ìë™ ë°ì´í„° ì‚­ì œ í”„ë¡œì‹œì €
DELIMITER //
CREATE PROCEDURE CleanupPersonalData()
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE cleanup_date DATE DEFAULT DATE_SUB(NOW(), INTERVAL 7 YEAR);
    
    -- 7ë…„ ê²½ê³¼ ê±°ë˜ ë°ì´í„° ìµëª…í™”
    UPDATE transactions 
    SET user_id = NULL, 
        receipt_data = JSON_REMOVE(receipt_data, '$.personal_info')
    WHERE created_at < cleanup_date;
    
    -- ë¹„í™œì„± ì‚¬ìš©ì ê°œì¸ì •ë³´ ì‚­ì œ (3ë…„ ë¯¸ì‚¬ìš©)
    DELETE FROM users 
    WHERE last_login < DATE_SUB(NOW(), INTERVAL 3 YEAR)
    AND consent_withdrawn = TRUE;
    
    -- ë¡œê·¸ ë°ì´í„° ì •ë¦¬ (1ë…„)
    DELETE FROM security_events 
    WHERE created_at < DATE_SUB(NOW(), INTERVAL 1 YEAR);
    
END //
DELIMITER ;

-- ë§¤ì›” ìë™ ì‹¤í–‰
CREATE EVENT MonthlyDataCleanup
ON SCHEDULE EVERY 1 MONTH
DO CALL CleanupPersonalData();
```

### 6.2 ì „ììƒê±°ë˜ë²• ì¤€ìˆ˜

#### 6.2.1 ì „ìì˜ìˆ˜ì¦ ë²•ì  ìš”ê±´
```json
{
  "receipt_requirements": {
    "mandatory_fields": [
      "ì‚¬ì—…ì ë“±ë¡ë²ˆí˜¸",
      "ìƒí˜¸ëª…",
      "ê±°ë˜ì¼ì‹œ",
      "ê±°ë˜í’ˆëª© ë° ìˆ˜ëŸ‰",
      "ê±°ë˜ê¸ˆì•¡",
      "ë¶€ê°€ê°€ì¹˜ì„¸ì•¡",
      "ì´ ê±°ë˜ê¸ˆì•¡"
    ],
    "optional_fields": [
      "ê³ ê° ì •ë³´ (ë™ì˜ ì‹œ)",
      "ì ë¦½ í¬ì¸íŠ¸",
      "í• ì¸ ë‚´ì—­"
    ],
    "storage_period": "5ë…„",
    "format": "PDF ë˜ëŠ” êµ¬ì¡°í™”ëœ ë°ì´í„°"
  },
  
  "refund_policy": {
    "refund_period": "14ì¼",
    "refund_conditions": [
      "ìƒí’ˆ ë¯¸ê°œë´‰",
      "ì˜ìˆ˜ì¦ ë³´ìœ ",
      "ê²°ì œ ìˆ˜ë‹¨ í™•ì¸ ê°€ëŠ¥"
    ],
    "refund_method": "ì› ê²°ì œ ìˆ˜ë‹¨ìœ¼ë¡œ í™˜ë¶ˆ"
  }
}
```

### 6.3 ì„¸ë²• ì¤€ìˆ˜

#### 6.3.1 ë¶€ê°€ê°€ì¹˜ì„¸ ì²˜ë¦¬
```python
class TaxCalculator:
    VAT_RATE = 0.1  # 10%
    
    def calculate_tax(self, items):
        tax_details = {
            "taxable_amount": 0,
            "tax_free_amount": 0,
            "vat_amount": 0,
            "total_amount": 0
        }
        
        for item in items:
            if item.is_tax_free:
                tax_details["tax_free_amount"] += item.price * item.quantity
            else:
                item_total = item.price * item.quantity
                vat = round(item_total * self.VAT_RATE / 1.1)
                tax_details["taxable_amount"] += (item_total - vat)
                tax_details["vat_amount"] += vat
        
        tax_details["total_amount"] = (
            tax_details["taxable_amount"] + 
            tax_details["tax_free_amount"] + 
            tax_details["vat_amount"]
        )
        
        return tax_details
```

---

## ğŸš€ 7. ë°°í¬ ë° ìš´ì˜ ê°€ì´ë“œë¼ì¸

### 7.1 CI/CD íŒŒì´í”„ë¼ì¸

#### 7.1.1 ìë™í™”ëœ ë°°í¬ í”„ë¡œì„¸ìŠ¤
```yaml
# .github/workflows/deploy.yml
name: Deploy Production

on:
  push:
    branches: [main]
    tags: ['v*']

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run Security Tests
        run: |
          bandit -r src/
          safety check
          semgrep --config=auto src/
      
      - name: Run Unit Tests
        run: |
          pytest tests/ --cov=src --cov-report=xml
          
      - name: Run Integration Tests
        run: |
          docker-compose up -d test-db
          pytest tests/integration/
  
  security-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: OWASP ZAP Security Scan
        run: |
          docker run -v $(pwd):/zap/wrk/:rw \
            owasp/zap2docker-stable zap-api-scan.py \
            -t http://api.selfpay.com/openapi.json
  
  deploy:
    needs: [test, security-scan]
    runs-on: ubuntu-latest
    environment: production
    steps:
      - name: Blue-Green Deployment
        run: |
          # ìƒˆ ë²„ì „ì„ ê·¸ë¦° í™˜ê²½ì— ë°°í¬
          kubectl apply -f k8s/green/
          
          # í—¬ìŠ¤ì²´í¬ í†µê³¼ í›„ íŠ¸ë˜í”½ ì „í™˜
          ./scripts/switch-traffic.sh green
          
          # ê¸°ì¡´ ë¸”ë£¨ í™˜ê²½ ì¢…ë£Œ
          kubectl delete -f k8s/blue/
```

### 7.2 ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

#### 7.2.1 êµ¬ì¡°í™”ëœ ë¡œê¹…
```python
import structlog
import json
from datetime import datetime

# êµ¬ì¡°í™”ëœ ë¡œê±° ì„¤ì •
structlog.configure(
    processors=[
        structlog.stdlib.filter_by_level,
        structlog.stdlib.add_logger_name,
        structlog.stdlib.add_log_level,
        structlog.stdlib.PositionalArgumentsFormatter(),
        structlog.processors.TimeStamper(fmt="ISO"),
        structlog.processors.StackInfoRenderer(),
        structlog.processors.format_exc_info,
        structlog.processors.JSONRenderer()
    ],
    context_class=dict,
    logger_factory=structlog.stdlib.LoggerFactory(),
    wrapper_class=structlog.stdlib.BoundLogger,
    cache_logger_on_first_use=True,
)

logger = structlog.get_logger()

# ì‚¬ìš© ì˜ˆì‹œ
def process_payment(user_id, transaction_data):
    logger.info(
        "payment_started",
        user_id=user_id,
        amount=transaction_data['amount'],
        payment_method=transaction_data['method'],
        correlation_id=transaction_data['correlation_id']
    )
    
    try:
        result = payment_gateway.process(transaction_data)
        
        logger.info(
            "payment_completed",
            user_id=user_id,
            transaction_id=result['transaction_id'],
            status=result['status'],
            correlation_id=transaction_data['correlation_id']
        )
        
        return result
        
    except PaymentException as e:
        logger.error(
            "payment_failed",
            user_id=user_id,
            error_code=e.error_code,
            error_message=str(e),
            correlation_id=transaction_data['correlation_id'],
            exc_info=True
        )
        raise
```

#### 7.2.2 ì„±ëŠ¥ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
```python
from prometheus_client import Counter, Histogram, Gauge
import time

# ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­
TRANSACTIONS_TOTAL = Counter(
    'transactions_total', 
    'Total number of transactions',
    ['store_id', 'payment_method', 'status']
)

TRANSACTION_DURATION = Histogram(
    'transaction_duration_seconds',
    'Time spent processing transaction',
    ['store_id', 'payment_method']
)

ACTIVE_SESSIONS = Gauge(
    'active_sessions_total',
    'Number of active user sessions',
    ['store_id']
)

# ë³´ì•ˆ ë©”íŠ¸ë¦­
SECURITY_EVENTS = Counter(
    'security_events_total',
    'Total security events',
    ['event_type', 'severity', 'store_id']
)

# ë°ì½”ë ˆì´í„°ë¥¼ í†µí•œ ìë™ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
def monitor_transaction(func):
    def wrapper(*args, **kwargs):
        start_time = time.time()
        store_id = kwargs.get('store_id', 'unknown')
        payment_method = kwargs.get('payment_method', 'unknown')
        
        try:
            result = func(*args, **kwargs)
            
            TRANSACTIONS_TOTAL.labels(
                store_id=store_id,
                payment_method=payment_method,
                status='success'
            ).inc()
            
            return result
            
        except Exception as e:
            TRANSACTIONS_TOTAL.labels(
                store_id=store_id,
                payment_method=payment_method,
                status='failed'
            ).inc()
            raise
            
        finally:
            duration = time.time() - start_time
            TRANSACTION_DURATION.labels(
                store_id=store_id,
                payment_method=payment_method
            ).observe(duration)
    
    return wrapper
```

---

## ğŸ“Š 8. ì„±ëŠ¥ ìµœì í™” ê°€ì´ë“œë¼ì¸

### 8.1 ì‹œìŠ¤í…œ ì„±ëŠ¥ ëª©í‘œ

#### 8.1.1 ì‘ë‹µ ì‹œê°„ ê¸°ì¤€
```yaml
performance_targets:
  api_response_times:
    barcode_scan: "< 500ms (95th percentile)"
    product_lookup: "< 300ms (95th percentile)"
    cart_operations: "< 200ms (95th percentile)"
    payment_processing: "< 2s (including PG response)"
    receipt_generation: "< 1s"
  
  throughput:
    concurrent_users: "1000+ per store"
    transactions_per_second: "100+ per server"
    barcode_scans_per_second: "500+ per server"
  
  availability:
    uptime: "99.9% (8.77 hours downtime per year)"
    recovery_time: "< 5 minutes"
```

#### 8.1.2 ìºì‹± ìµœì í™”
```python
import redis
from functools import wraps
import json
import hashlib

class CacheManager:
    def __init__(self):
        self.redis_client = redis.Redis(
            host='redis-cluster',
            port=6379,
            decode_responses=True,
            health_check_interval=30
        )
    
    def cache_product_info(self, ttl=3600):
        def decorator(func):
            @wraps(func)
            def wrapper(store_id, barcode):
                cache_key = f"product:{store_id}:{barcode}"
                
                # ìºì‹œì—ì„œ ì¡°íšŒ
                cached_data = self.redis_client.get(cache_key)
                if cached_data:
                    return json.loads(cached_data)
                
                # ìºì‹œ ë¯¸ìŠ¤ ì‹œ DB ì¡°íšŒ
                result = func(store_id, barcode)
                
                # ê²°ê³¼ ìºì‹±
                if result:
                    self.redis_client.setex(
                        cache_key, 
                        ttl, 
                        json.dumps(result)
                    )
                
                return result
            return wrapper
        return decorator
    
    def invalidate_product_cache(self, store_id, barcode=None):
        """ìƒí’ˆ ì •ë³´ ë³€ê²½ ì‹œ ìºì‹œ ë¬´íš¨í™”"""
        if barcode:
            cache_key = f"product:{store_id}:{barcode}"
            self.redis_client.delete(cache_key)
        else:
            # ë§¤ì¥ì˜ ëª¨ë“  ìƒí’ˆ ìºì‹œ ì‚­ì œ
            pattern = f"product:{store_id}:*"
            keys = self.redis_client.keys(pattern)
            if keys:
                self.redis_client.delete(*keys)
```

### 8.2 ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”

#### 8.2.1 ì¿¼ë¦¬ ìµœì í™”
```sql
-- ìì£¼ ì‚¬ìš©ë˜ëŠ” ì¿¼ë¦¬ ìµœì í™”
-- 1. ìƒí’ˆ ì¡°íšŒ (ë°”ì½”ë“œ ìŠ¤ìº”)
CREATE INDEX CONCURRENTLY idx_products_optimized 
ON products(store_id, barcode, status) 
WHERE status = 'ACTIVE';

-- 2. ì‚¬ìš©ì ê±°ë˜ ë‚´ì—­ ì¡°íšŒ
CREATE INDEX CONCURRENTLY idx_transactions_user_recent 
ON transactions(user_id, created_at DESC) 
WHERE payment_status = 'COMPLETED';

-- 3. ë§¤ì¥ë³„ ì‹¤ì‹œê°„ í†µê³„
CREATE MATERIALIZED VIEW store_stats AS
SELECT 
    store_id,
    DATE(created_at) as date,
    COUNT(*) as transaction_count,
    SUM(total_amount) as daily_revenue,
    AVG(total_amount) as avg_transaction_amount
FROM transactions 
WHERE payment_status = 'COMPLETED'
GROUP BY store_id, DATE(created_at);

-- í†µê³„ ë·° ìë™ ê°±ì‹ 
CREATE UNIQUE INDEX ON store_stats (store_id, date);
```

#### 8.2.2 ì—°ê²° í’€ ìµœì í™”
```python
from sqlalchemy import create_engine
from sqlalchemy.pool import QueuePool

# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í’€ ì„¤ì •
engine = create_engine(
    "postgresql://user:pass@db-host/selfpay",
    poolclass=QueuePool,
    pool_size=20,        # ê¸°ë³¸ ì—°ê²° ê°œìˆ˜
    max_overflow=30,     # ìµœëŒ€ ì¶”ê°€ ì—°ê²°
    pool_pre_ping=True,  # ì—°ê²° ìƒíƒœ í™•ì¸
    pool_recycle=3600,   # 1ì‹œê°„ë§ˆë‹¤ ì—°ê²° ì¬ìƒì„±
    echo=False           # í”„ë¡œë•ì…˜ì—ì„œëŠ” False
)

# ì½ê¸° ì „ìš© ë³µì œë³¸ í™œìš©
read_engine = create_engine(
    "postgresql://user:pass@db-replica/selfpay",
    poolclass=QueuePool,
    pool_size=10,
    max_overflow=20
)

class DatabaseManager:
    def __init__(self):
        self.write_engine = engine
        self.read_engine = read_engine
    
    def get_read_connection(self):
        """ì½ê¸° ì „ìš© ì¿¼ë¦¬ìš© ì—°ê²°"""
        return self.read_engine.connect()
    
    def get_write_connection(self):
        """ì“°ê¸° ì¿¼ë¦¬ìš© ì—°ê²°"""
        return self.write_engine.connect()
```

---

## ğŸ§ª 9. í…ŒìŠ¤íŠ¸ ì „ëµ ê°€ì´ë“œë¼ì¸

### 9.1 í¬ê´„ì  í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€

#### 9.1.1 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
```python
import pytest
from unittest.mock import Mock, patch
from src.services.payment_service import PaymentService
from src.exceptions import PaymentException

class TestPaymentService:
    def setup_method(self):
        self.payment_service = PaymentService()
        self.mock_pg_client = Mock()
    
    @patch('src.services.payment_service.NaverPayClient')
    def test_process_payment_success(self, mock_naver_pay):
        # Arrange
        mock_naver_pay.return_value = self.mock_pg_client
        self.mock_pg_client.process_payment.return_value = {
            'status': 'SUCCESS',
            'transaction_id': 'TX123456'
        }
        
        payment_data = {
            'amount': 10000,
            'items': [{'product_id': 1, 'quantity': 2}],
            'payment_method': 'NAVER_PAY'
        }
        
        # Act
        result = self.payment_service.process_payment(payment_data)
        
        # Assert
        assert result['status'] == 'SUCCESS'
        assert result['transaction_id'] == 'TX123456'
        self.mock_pg_client.process_payment.assert_called_once()
    
    def test_calculate_total_amount(self):
        items = [
            {'price': 1000, 'quantity': 2},
            {'price': 500, 'quantity': 3}
        ]
        
        total = self.payment_service.calculate_total_amount(items)
        
        assert total == 3500  # (1000*2) + (500*3)
    
    @pytest.mark.parametrize("invalid_amount", [-100, 0, None])
    def test_validate_payment_amount_invalid(self, invalid_amount):
        with pytest.raises(PaymentException) as exc_info:
            self.payment_service.validate_payment_amount(invalid_amount)
        
        assert exc_info.value.error_code == 4004
```

#### 9.1.2 í†µí•© í…ŒìŠ¤íŠ¸
```python
import pytest
from fastapi.testclient import TestClient
from src.main import app
from src.database import get_db_session
from tests.fixtures import create_test_store, create_test_user

@pytest.fixture
def client():
    return TestClient(app)

@pytest.fixture
def test_data(db_session):
    store = create_test_store(db_session)
    user = create_test_user(db_session)
    return {'store': store, 'user': user}

class TestCheckoutFlow:
    def test_complete_checkout_flow(self, client, test_data):
        """ì „ì²´ ì²´í¬ì•„ì›ƒ í”Œë¡œìš° í…ŒìŠ¤íŠ¸"""
        store_id = test_data['store']['id']
        user_id = test_data['user']['id']
        
        # 1. ë¡œê·¸ì¸
        login_response = client.post("/api/v1/auth/login", json={
            "phone": test_data['user']['phone'],
            "verification_code": "123456"
        })
        assert login_response.status_code == 200
        token = login_response.json()['access_token']
        headers = {"Authorization": f"Bearer {token}"}
        
        # 2. ì„¸ì…˜ ì‹œì‘
        session_response = client.post(
            f"/api/v1/stores/{store_id}/sessions",
            headers=headers
        )
        assert session_response.status_code == 201
        session_id = session_response.json()['session_id']
        
        # 3. ìƒí’ˆ ìŠ¤ìº”
        scan_response = client.post(
            f"/api/v1/products/scan",
            json={"barcode": "1234567890123", "store_id": store_id},
            headers=headers
        )
        assert scan_response.status_code == 200
        product = scan_response.json()
        
        # 4. ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€
        cart_response = client.post(
            f"/api/v1/cart/items",
            json={
                "session_id": session_id,
                "product_id": product['id'],
                "quantity": 2
            },
            headers=headers
        )
        assert cart_response.status_code == 201
        
        # 5. ê²°ì œ ì²˜ë¦¬
        payment_response = client.post(
            f"/api/v1/payments/process",
            json={
                "session_id": session_id,
                "payment_method": "NAVER_PAY",
                "total_amount": product['price'] * 2
            },
            headers=headers
        )
        assert payment_response.status_code == 200
        assert payment_response.json()['status'] == 'COMPLETED'
```

#### 9.1.3 ë¶€í•˜ í…ŒìŠ¤íŠ¸
```python
# locustfile.py
from locust import HttpUser, task, between
import json
import random

class SelfPayUser(HttpUser):
    wait_time = between(1, 3)
    
    def on_start(self):
        """ì‚¬ìš©ì ì„¸ì…˜ ì‹œì‘"""
        self.login()
        self.start_session()
    
    def login(self):
        response = self.client.post("/api/v1/auth/login", json={
            "phone": f"010{random.randint(10000000, 99999999)}",
            "verification_code": "123456"
        })
        
        if response.status_code == 200:
            self.token = response.json()['access_token']
            self.headers = {"Authorization": f"Bearer {self.token}"}
    
    def start_session(self):
        response = self.client.post(
            "/api/v1/stores/1/sessions",
            headers=self.headers
        )
        
        if response.status_code == 201:
            self.session_id = response.json()['session_id']
    
    @task(3)
    def scan_product(self):
        """ìƒí’ˆ ìŠ¤ìº” (ê°€ì¥ ë¹ˆë²ˆí•œ ì‘ì—…)"""
        barcode = random.choice([
            "1234567890123", "2345678901234", 
            "3456789012345", "4567890123456"
        ])
        
        self.client.post(
            "/api/v1/products/scan",
            json={"barcode": barcode, "store_id": 1},
            headers=self.headers,
            name="/api/v1/products/scan"
        )
    
    @task(2)
    def manage_cart(self):
        """ì¥ë°”êµ¬ë‹ˆ ê´€ë¦¬"""
        self.client.post(
            "/api/v1/cart/items",
            json={
                "session_id": self.session_id,
                "product_id": random.randint(1, 100),
                "quantity": random.randint(1, 5)
            },
            headers=self.headers,
            name="/api/v1/cart/items"
        )
    
    @task(1)
    def process_payment(self):
        """ê²°ì œ ì²˜ë¦¬"""
        self.client.post(
            "/api/v1/payments/process",
            json={
                "session_id": self.session_id,
                "payment_method": random.choice(["NAVER_PAY", "KAKAO_PAY"]),
                "total_amount": random.randint(1000, 50000)
            },
            headers=self.headers,
            name="/api/v1/payments/process"
        )
```

---

## ğŸ”® 10. ë¯¸ë˜ í™•ì¥ì„± ê³ ë ¤ì‚¬í•­

### 10.1 ê¸°ìˆ ì  í™•ì¥ì„±

#### 10.1.1 ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ ì¤€ë¹„
```yaml
# docker-compose.yml - ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ êµ¬ì¡°
version: '3.8'

services:
  # ì‚¬ìš©ì ì¸ì¦ ì„œë¹„ìŠ¤
  auth-service:
    build: ./services/auth
    environment:
      - DATABASE_URL=postgresql://auth_db
      - JWT_SECRET=${JWT_SECRET}
    depends_on:
      - auth-db
  
  # ìƒí’ˆ ê´€ë¦¬ ì„œë¹„ìŠ¤
  product-service:
    build: ./services/product
    environment:
      - DATABASE_URL=postgresql://product_db
      - REDIS_URL=redis://cache
    depends_on:
      - product-db
      - cache
  
  # ê²°ì œ ì„œë¹„ìŠ¤
  payment-service:
    build: ./services/payment
    environment:
      - DATABASE_URL=postgresql://payment_db
      - NAVER_PAY_API_KEY=${NAVER_PAY_API_KEY}
      - KAKAO_PAY_API_KEY=${KAKAO_PAY_API_KEY}
    depends_on:
      - payment-db
  
  # API ê²Œì´íŠ¸ì›¨ì´
  api-gateway:
    image: nginx:alpine
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    ports:
      - "80:80"
      - "443:443"
    depends_on:
      - auth-service
      - product-service
      - payment-service
```

#### 10.1.2 AI/ML ê¸°ëŠ¥ í™•ì¥
```python
# AI ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤
from abc import ABC, abstractmethod
from typing import List, Dict, Any

class AIServiceInterface(ABC):
    @abstractmethod
    async def detect_suspicious_behavior(
        self, 
        video_frames: List[bytes],
        user_context: Dict[str, Any]
    ) -> Dict[str, Any]:
        """ì˜ì‹¬ìŠ¤ëŸ¬ìš´ í–‰ë™ íƒì§€"""
        pass
    
    @abstractmethod
    async def recognize_products_without_barcode(
        self, 
        image: bytes,
        store_context: Dict[str, Any]
    ) -> List[Dict[str, Any]]:
        """ë°”ì½”ë“œ ì—†ëŠ” ìƒí’ˆ ì¸ì‹"""
        pass
    
    @abstractmethod
    async def predict_inventory_needs(
        self,
        store_id: str,
        historical_data: Dict[str, Any]
    ) -> Dict[str, Any]:
        """ì¬ê³  ìˆ˜ìš” ì˜ˆì¸¡"""
        pass

class VisionAIService(AIServiceInterface):
    def __init__(self):
        self.behavior_model = self.load_behavior_model()
        self.product_recognition_model = self.load_product_model()
    
    async def detect_suspicious_behavior(self, video_frames, user_context):
        # ì‹¤ì‹œê°„ í–‰ë™ ë¶„ì„
        behavior_score = await self.behavior_model.analyze(
            frames=video_frames,
            context=user_context
        )
        
        return {
            "suspicious_score": behavior_score,
            "alert_level": self.calculate_alert_level(behavior_score),
            "recommended_action": self.get_recommended_action(behavior_score)
        }
```

### 10.2 ë¹„ì¦ˆë‹ˆìŠ¤ í™•ì¥ì„±

#### 10.2.1 ë‹¤ì¤‘ í…Œë„ŒíŠ¸ ì§€ì›
```python
# ë©€í‹° í…Œë„ŒíŠ¸ ì•„í‚¤í…ì²˜
class TenantManager:
    def __init__(self):
        self.tenant_configs = {}
    
    def get_tenant_config(self, tenant_id: str) -> Dict[str, Any]:
        """í…Œë„ŒíŠ¸ë³„ ì„¤ì • ì¡°íšŒ"""
        return {
            "database_schema": f"tenant_{tenant_id}",
            "payment_methods": self.get_enabled_payment_methods(tenant_id),
            "security_level": self.get_security_level(tenant_id),
            "features": self.get_enabled_features(tenant_id),
            "branding": self.get_branding_config(tenant_id)
        }
    
    def create_tenant_database(self, tenant_id: str):
        """ìƒˆ í…Œë„ŒíŠ¸ìš© ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìƒì„±"""
        schema_name = f"tenant_{tenant_id}"
        
        with engine.connect() as conn:
            conn.execute(f"CREATE SCHEMA IF NOT EXISTS {schema_name}")
            
            # í…Œë„ŒíŠ¸ë³„ í…Œì´ë¸” ìƒì„±
            for table in TENANT_TABLES:
                table.create(
                    engine, 
                    schema=schema_name,
                    checkfirst=True
                )
```

#### 10.2.2 ê¸€ë¡œë²Œ í™•ì¥ ê³ ë ¤ì‚¬í•­
```yaml
internationalization:
  supported_locales:
    - ko_KR  # í•œêµ­ì–´
    - en_US  # ì˜ì–´
    - ja_JP  # ì¼ë³¸ì–´
    - zh_CN  # ì¤‘êµ­ì–´ ê°„ì²´
    - zh_TW  # ì¤‘êµ­ì–´ ë²ˆì²´
  
  currency_support:
    - KRW    # í•œêµ­ ì›
    - USD    # ë¯¸êµ­ ë‹¬ëŸ¬
    - JPY    # ì¼ë³¸ ì—”
    - CNY    # ì¤‘êµ­ ìœ„ì•ˆ
  
  payment_methods_by_region:
    KR: ["NAVER_PAY", "KAKAO_PAY", "TOSS_PAY"]
    US: ["APPLE_PAY", "GOOGLE_PAY", "PAYPAL"]
    JP: ["LINE_PAY", "RAKUTEN_PAY", "PAYPAY"]
    CN: ["ALIPAY", "WECHAT_PAY", "UNIONPAY"]
  
  regulatory_compliance:
    GDPR: ["EU"]
    CCPA: ["US_CA"]
    PIPEDA: ["CA"]
    LGPD: ["BR"]
    ê°œì¸ì •ë³´ë³´í˜¸ë²•: ["KR"]
```

---

## ğŸ“ êµ¬í˜„ ìš°ì„ ìˆœìœ„ ë° ë¡œë“œë§µ

### Phase 1: MVP (3ê°œì›”) - **ì§„í–‰ ì¤‘**
- âœ… ê¸°ë³¸ ë°”ì½”ë“œ ìŠ¤ìº” ê¸°ëŠ¥ (ìˆ˜ë™ ì…ë ¥)
- âœ… ì¹´ë©”ë¼ ë°”ì½”ë“œ ìŠ¤ìº” (html5-qrcode ë¼ì´ë¸ŒëŸ¬ë¦¬)
- âœ… ë„¤ì´ë²„í˜ì´ ì—°ë™ (Mock + Sandbox + Production ëª¨ë“œ ì§€ì›)
- âœ… ì¥ë°”êµ¬ë‹ˆ ê´€ë¦¬ (ì¶”ê°€/ì‚­ì œ/ìˆ˜ëŸ‰ ë³€ê²½)
- âœ… ê²°ì œ í”Œë¡œìš° (ìŠ¤ìº” â†’ ì²´í¬ì•„ì›ƒ â†’ ê²°ì œ â†’ ì™„ë£Œ)
- âœ… ì „ìì˜ìˆ˜ì¦ í‘œì‹œ ë° ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸
- âœ… **í…ŒìŠ¤íŠ¸ ì½”ë“œ (104ê°œ í…ŒìŠ¤íŠ¸, 84% ì»¤ë²„ë¦¬ì§€)** â­
- âœ… **JWT ì¸ì¦ ì‹œìŠ¤í…œ (íšŒì›ê°€ì…/ë¡œê·¸ì¸, í† í° ê´€ë¦¬, ì„ íƒì  ì¸ì¦)** â­
- â¬œ ê°„ë‹¨í•œ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ

### Phase 2: ë³´ì•ˆ ê°•í™” (2ê°œì›”)
- â¬œ ì¤‘ëŸ‰ ê²€ì¦ ì‹œìŠ¤í…œ
- â¬œ CCTV ì—°ë™ ë° ê¸°ë³¸ AI ë¶„ì„
- â¬œ ì¶œêµ¬ ê²Œì´íŠ¸ ì‹œìŠ¤í…œ
- â¬œ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§

### Phase 3: ê³ ë„í™” (3ê°œì›”)
- â¬œ ê³ ê¸‰ AI í–‰ë™ ë¶„ì„
- â¬œ ë‹¤ì¤‘ ë§¤ì¥ ì§€ì›
- â¬œ ì ‘ê·¼ì„± ê°œì„ 
- â¬œ ì˜¤í”„ë¼ì¸ ëª¨ë“œ

### Phase 4: í™•ì¥ (ì§€ì†ì )
- â¬œ ê°œì¸í™” ì¶”ì²œ
- â¬œ ë©¤ë²„ì‹­/í¬ì¸íŠ¸ ì‹œìŠ¤í…œ
- â¬œ ê¸€ë¡œë²Œ í™•ì¥
- â¬œ í”„ëœì°¨ì´ì¦ˆ ì§€ì›

ì´ ê°€ì´ë“œë¼ì¸ì„ í†µí•´ ì•ˆì „í•˜ê³  í™•ì¥ ê°€ëŠ¥í•œ ë¬´ì¸ê³„ì‚° ì‹œìŠ¤í…œì„ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.